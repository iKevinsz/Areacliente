generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// --- NOVAS TABELAS ADICIONADAS ---

model Usuario {
  id       Int      @id @default(autoincrement())
  nome     String
  email    String   @unique
  senha    String
  criadoEm DateTime @default(now())
}

model Empresa {
  id                Int         @id @default(autoincrement())
  cnpj              String      @unique
  ie                String?
  im                String?
  segmento          String?
  razaoSocial       String?
  nomeFantasia      String?
  cep               String?
  endereco          String?
  numero            String?
  bairro            String?
  complemento       String?
  uf                String?
  cidade            String?
  telefone          String?
  telefoneComercial String?
  celular           String?
  contato           String?
  email             String?
  site              String?
  logo              String?     @db.LongText
  fusoHorario       String?
  categorias        String?
  tempoEstimado     String?
  tempoEntrega      String?
  linkLoja          String?
  whatsapp          String?
  facebook          String?
  instagram         String?
  youtube           String?
  twitter           String?
  Grupo             Grupo[]
  Avaliacao         Avaliacao[]
}

model Grupo {
  id           Int                @id @default(autoincrement())
  nome         String
  ordem        Int                @default(0)
  ativo        Boolean            @default(true)
  empresaId    Int
  empresa      Empresa            @relation(fields: [empresaId], references: [id])
  produtos     Produto[]
  variacoes    GrupoVariacao[]
  complementos GrupoComplemento[]
}

model Avaliacao {
  id          Int      @id @default(autoincrement())
  nota        Int
  comentario  String?
  clienteNome String   @default("Cliente Anônimo")
  resposta    String?
  tags        String?
  criadoEm    DateTime @default(now())
  empresaId   Int
  empresa     Empresa  @relation(fields: [empresaId], references: [id])
}

// --- TABELAS EXISTENTES (CORRIGIDAS) ---

model Produto {
  id                 Int     @id @default(autoincrement())
  nome               String
  descricao          String? @db.Text // Adicionado de volta
  categoria          String?
  preco              Decimal @db.Decimal(10, 2)
  imagem             String? @db.LongText
  ativo              Boolean @default(true)
  estoque            Int     @default(0)
  permiteComplemento Boolean @default(false)
  visivelOnline      Boolean @default(true)

  criadoEm     DateTime @default(now()) // Adicionado de volta
  atualizadoEm DateTime @updatedAt // Adicionado de volta

  // Relações
  grupoId      Int?
  grupo        Grupo?        @relation(fields: [grupoId], references: [id])
  variacoes    Variacao[]
  complementos Complemento[]
  itensPedido  ItemPedido[]
}

model Variacao {
  id        Int     @id @default(autoincrement())
  nome      String
  preco     Decimal @db.Decimal(10, 2)
  produtoId Int
  produto   Produto @relation(fields: [produtoId], references: [id])
}

model Complemento {
  id        Int     @id @default(autoincrement())
  nome      String
  preco     Decimal @db.Decimal(10, 2)
  produtoId Int
  produto   Produto @relation(fields: [produtoId], references: [id])
}

model Pedido {
  id      Int          @id @default(autoincrement())
  cliente String?
  tipo    String
  status  String       @default("Pendente")
  total   Decimal      @db.Decimal(10, 2)
  data    DateTime     @default(now())
  itens   ItemPedido[]
}

model ItemPedido {
  id         Int     @id @default(autoincrement())
  quantidade Int
  precoUnit  Decimal @db.Decimal(10, 2)
  pedidoId   Int
  pedido     Pedido  @relation(fields: [pedidoId], references: [id])
  produtoId  Int
  produto    Produto @relation(fields: [produtoId], references: [id])
}

model GrupoVariacao {
  id      Int    @id @default(autoincrement())
  nome    String
  grupoId Int
  grupo   Grupo  @relation(fields: [grupoId], references: [id], onDelete: Cascade)
}

model GrupoComplemento {
  id          Int     @id @default(autoincrement())
  nome        String
  preco       Decimal @db.Decimal(10, 2)
  maxQtd      Int     @default(1)
  obrigatorio Boolean @default(false)
  grupoId     Int
  grupo       Grupo   @relation(fields: [grupoId], references: [id], onDelete: Cascade)
}
